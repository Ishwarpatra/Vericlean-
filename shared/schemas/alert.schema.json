{
    "$schema": "http://json-schema.org/draft-07/schema#",
    "$id": "https://cleanvee.app/schemas/alert.json",
    "title": "Alert",
    "description": "An alert generated by the system for safety, quality, or SLA issues",
    "type": "object",
    "required": [
        "building_id",
        "checkpoint_id",
        "type",
        "severity",
        "status",
        "created_at"
    ],
    "properties": {
        "id": {
            "type": "string",
            "description": "Unique identifier for the alert"
        },
        "building_id": {
            "type": "string",
            "description": "ID of the building where the alert originated"
        },
        "checkpoint_id": {
            "type": "string",
            "description": "ID of the checkpoint associated with this alert"
        },
        "related_log_id": {
            "type": [
                "string",
                "null"
            ],
            "description": "ID of the cleaning log that triggered this alert, if applicable"
        },
        "type": {
            "$ref": "#/definitions/AlertType"
        },
        "severity": {
            "$ref": "#/definitions/AlertSeverity"
        },
        "status": {
            "$ref": "#/definitions/AlertStatus"
        },
        "message": {
            "type": "string",
            "description": "Human-readable alert message"
        },
        "details": {
            "type": "object",
            "description": "Additional context-specific details",
            "properties": {
                "score": {
                    "type": "integer",
                    "description": "Quality score that triggered the alert"
                },
                "detected_hazards": {
                    "type": "array",
                    "items": {
                        "type": "string"
                    },
                    "description": "List of hazard labels detected"
                },
                "hours_overdue": {
                    "type": "number",
                    "description": "Hours since last cleaning (for SLA alerts)"
                },
                "sla_threshold_hours": {
                    "type": "number",
                    "description": "SLA threshold that was breached"
                }
            }
        },
        "last_cleaned_at": {
            "type": [
                "string",
                "null"
            ],
            "format": "date-time",
            "description": "When the checkpoint was last cleaned (for SLA alerts)"
        },
        "created_at": {
            "type": "string",
            "format": "date-time",
            "description": "When the alert was created"
        },
        "resolved_at": {
            "type": [
                "string",
                "null"
            ],
            "format": "date-time",
            "description": "When the alert was resolved"
        },
        "resolved_by_log_id": {
            "type": [
                "string",
                "null"
            ],
            "description": "ID of the cleaning log that resolved this alert"
        }
    },
    "definitions": {
        "AlertType": {
            "type": "string",
            "enum": [
                "SAFETY_HAZARD",
                "QUALITY_FAILURE",
                "SLA_MISSING_CLEAN",
                "SLA_BREACH_RECOVERED"
            ],
            "description": "Type of alert"
        },
        "AlertSeverity": {
            "type": "string",
            "enum": [
                "LOW",
                "MEDIUM",
                "HIGH",
                "CRITICAL"
            ],
            "description": "Severity level of the alert"
        },
        "AlertStatus": {
            "type": "string",
            "enum": [
                "OPEN",
                "ACKNOWLEDGED",
                "RESOLVED",
                "DISMISSED"
            ],
            "default": "OPEN",
            "description": "Current status of the alert"
        }
    }
}